(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const e of r.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&o(e)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();let b=new PMTiles.Protocol;maplibregl.addProtocol("pmtiles",b.tile);let i,l={type:"FeatureCollection",features:[]};function g(s,a){return s==="N/A"||a==="N/A"?"N/A":`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${s},${a}`}function m(){const s=document.querySelector(".spinner-container");s&&(s.style.display="none")}async function k(){try{const[s,a,n]=await Promise.all([d3.csv("../data/Top_50_Sites_Final.csv"),d3.json("../data/d10-polygon.geojson"),d3.json("../data/d10-counties-polygon.geojson")]);s.forEach(o=>{const t=parseFloat(o.DOTLatitude),r=parseFloat(o.DOTLongitude);!isNaN(t)&&!isNaN(r)&&l.features.push({type:"Feature",properties:{rank:parseInt(o.Rank),county:o.County,route:o.RT_Label,functionalClass:o.FunctionalClassification,rfLat:o.RFLatitude,rfLon:o.RFLongitude,rfMP:o.RFMP,lsLat:o.LSLatitude,lsLon:o.LSLongitude,lsMP:o.LSMP},geometry:{type:"Point",coordinates:[r,t]}})}),h(a,n),m(),console.log(`Loaded ${l.features.length} sites.`)}catch(s){console.error("Error loading data:",s),m()}}function h(s,a){i=new maplibregl.Map({container:"map",style:{version:8,sources:{satellite:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256},dem:{type:"raster-dem",url:"./terrain.json"},"ky-streams":{type:"vector",url:"pmtiles://https://contig.us/data/pmtiles/ky_strm_line.pmtiles"},"ky-area":{type:"vector",url:"pmtiles://https://contig.us/data/pmtiles/ky_strm_area.pmtiles"},"ky-waterbody":{type:"vector",url:"pmtiles://https://contig.us/data/pmtiles/ky_strm_waterbody.pmtiles"},sites:{type:"geojson",data:l},d10:{type:"geojson",data:s},counties:{type:"geojson",data:a}},layers:[{id:"background",type:"background",paint:{"background-color":"#ddeeff"}},{id:"satellite",type:"raster",source:"satellite",paint:{"raster-opacity":1}},{id:"district-10-extruded",type:"fill-extrusion",source:"d10",paint:{"fill-extrusion-color":"#ffff00","fill-extrusion-opacity":0,"fill-extrusion-height":50,"fill-extrusion-base":0}},{id:"ky-streams",type:"line",source:"ky-streams","source-layer":"ky_strm_line",filter:["any",["in","ftype",460,558]],layout:{visibility:"visible","line-cap":"round","line-join":"round"},paint:{"line-color":"#4fa9e9","line-width":2,"line-opacity":["interpolate",["linear"],["zoom"],12,0,13,1]}},{id:"ky-area",type:"fill",source:"ky-area","source-layer":"ky_strm_area",layout:{visibility:"visible"},paint:{"fill-color":["match",["get","ftype"],403,"#8cc4e7","#4fa9e9"],"fill-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},{id:"ky-waterbody",type:"fill",source:"ky-waterbody","source-layer":"ky_strm_waterbody",layout:{visibility:"visible"},paint:{"fill-color":"#4fa9e9","fill-opacity":["interpolate",["linear"],["zoom"],12,0,13,1]}},{id:"ky-ponds",type:"fill",source:"ky-waterbody","source-layer":"ky_strm_waterbody",filter:["<=",["get","areasqkm"],.05],layout:{visibility:"visible"},paint:{"fill-color":"#4fa9e9","fill-opacity":["interpolate",["linear"],["zoom"],12,0,13,1]}},{id:"sites-points",type:"circle",source:"sites",paint:{"circle-radius":8,"circle-color":"#a100e0","circle-stroke-width":1,"circle-stroke-color":"#fff"}}]},center:[-83.5,37.5],zoom:8,pitch:60,bearing:-20,hash:!0}),i.on("load",()=>{i.setTerrain({source:"dem",exaggeration:2});const n=turf.bbox(s);i.fitBounds(n,{padding:10}),i.on("click","sites-points",o=>{const t=i.queryRenderedFeatures(o.point,{layers:["sites-points"]});if(!t.length)return;const r=t[0],e=r.properties||{},c=e.rfLat&&e.rfLat!=="N/A"?parseFloat(e.rfLat):null,p=e.rfLon&&e.rfLon!=="N/A"?parseFloat(e.rfLon):null,u=e.lsLat&&e.lsLat!=="N/A"?parseFloat(e.lsLat):null,d=e.lsLon&&e.lsLon!=="N/A"?parseFloat(e.lsLon):null,y=c&&p?g(c,p):"N/A",f=u&&d?g(u,d):"N/A",L=`
        <strong>Rank:</strong> ${e.rank||"N/A"}<br>
        <strong>County:</strong> ${e.county||"N/A"}<br>
        <strong>Route:</strong> ${e.route||"N/A"}<br>
        <strong>Functional Class:</strong> ${e.functionalClass||"N/A"}<br>
        <strong>Rockfall MP:</strong> ${y==="N/A"?"N/A":`<a href="${y}" target="_blank">${e.rfMP||"Link"}</a>`}<br>
        <strong>Landslide MP:</strong> ${f==="N/A"?"N/A":`<a href="${f}" target="_blank">${e.lsMP||"Link"}</a>`}
      `;new maplibregl.Popup().setLngLat(r.geometry.coordinates).setHTML(L).addTo(i)}),i.on("mouseenter","sites-points",()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave","sites-points",()=>{i.getCanvas().style.cursor=""})})}k();
